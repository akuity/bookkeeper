---
title: CLI
description: Using Bookkeeper's command line interface
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Using Bookkeeper's CLI

Bookkeeper has dependencies on Git, Kustomize, ytt, and Helm binaries. If
integrating with GitHub Actions or any other automation platform that supports
Docker containers, the official Bookkeeper Docker image can ensure that
compatible versions of those binaries are available to Bookkeeper.

In the event that you wish to integrate Bookkeeper into workflows implemented
using an automation platform that does _not_ support Docker containers, the
`bookkeeper` command line interface provides a means of offloading configuration
rendering to a Bookkeeper _server_.

## Installing the server

It is possible to install a Bookkeeper server on any container-enabled hosting
platform, but it is particularly convenient to install it on a Kubernetes
cluster using Bookkeeper's official Helm chart.

:::info
The Helm chart for Bookkeeper, much like Bookkeeper's container image, is hosted
in the GitHub Container Registry and is currently accessible only by Akuity
employees. This means you will need to log into the `ghcr.io` registry to
proceed, exactly as if you were going to pull a private image from there.

When Bookkeeper is eventually made public, this step will no longer be
necessary.
:::

Use the command `docker login ghcr.io` and follow the prompts. Use your GitHub
handle for the username and, for the password, use a
[personal access token](https://github.com/settings/tokens) with adequate
permissions to pull packages.

<Tabs groupId="installation">
<TabItem value="basic" label="Basic installation">

To install the Bookkeeper server on your Kubernetes cluster with default
options:

```shell
helm install bookkeeper \
  oci://ghcr.io/akuityio/bookkeeper-chart/bookkeeper \
  --version v0.1.0-alpha.1-rc.3 \
  --create-namespace \
  --namespace bookkeeper \
  --wait
```

You can expose the server on `localhost` using the following `kubectl` command:

```shell
kubectl port-forward svc/bookkeeper -n bookkeeper 8443:443
```

</TabItem>
<TabItem value="advanced" label="Advanced installation">

Bookkeeper's Helm chart exposes a variety of useful configuration options. To
explore them, extract the options from the chart and save them to a file:

```shell
helm inspect values \
  oci://ghcr.io/akuityio/bookkeeper-chart/bookkeeper \
  --version v0.1.0-alpha.1-rc.3 > ~/bookkeeper-values.yaml
```

The file is liberally commented. Edit it as desired, save your changes, and
install like so:

```shell
helm install bookkeeper \
  oci://ghcr.io/akuityio/bookkeeper-chart/bookkeeper \
  --version v0.1.0-alpha.1-rc.3 \
  --create-namespace \
  --namespace bookkeeper \
  --values ~/bookkeeper-values.yaml \
  --wait
```

</TabItem>
</Tabs>

## Installing the CLI

The `bookkeeper` CLI can be downloaded directly from the
[releases page](https://github.com/akuityio/bookkeeper-prototype/releases).

:::note
You may need to update permissions on the downloaded binary to enable your
system to execute it. You should also consider renaming the binary to
`bookkeeper` and moving it to a location on your `PATH`.
:::

## Basic CLI usage

Once your Bookkeeper server is running, rendering configuration using the
`bookkeeper render` command is straightforward. The required inputs for the
command, each with their own flag, include:

* `--server`: The address of the Bookkeeper server. If you followed the basic
  installation instructions, this is `https://localhost:8443`.

  :::note
  If you use the `bookkeeper` CLI frequently, you can specify a persistent
  server address using the `BOOKKEEPER_SERVER` environment variable.
  :::

* `--repo`: The URL for cloning your GitOps repository, beginning with
  `https://`

* `--repo-username`: Username for reading from and writing to your GitOps
  repository

* `--repo-password`: Password (or personal access token) for reading from and
  writing to your GitOps repository

  :::caution
  In some contexts, it is not secure to specify a password or token directly in
  a command. To accommodate such circumstances, the repository password can also
  be specified using the `BOOKKEEPER_REPO_PASSWORD` environment variable. Since
  username and password are complementary pieces of information, the repository
  username may also be specified in this manner, using the
  `BOOKKEEPER_REPO_USERNAME` environment variable.
  
  The above may be especially relevant if incorporating the `bookkeeper` CLI
  into any sort of automated processes. 
  :::

* `--target-branch`: The environment-specific branch in which to store rendered
  configuration
  
  :::info
  Bookkeeper also uses this value to locate the environment-specific paths in
  your repository's default branch.
  :::

:::tip
If you followed the basic installation instructions for the Bookkeeper server,
you should also use the `--insecure` flag to dismiss errors related to the
server's self-signed certificate.
:::

Example usage:

```shell
bookkeeper render \
  --server https://localhost:8443 \
  --insecure \
  --repo https://<repo URL> \
  --repo-username <username> \
  --repo-password <password or personal access token> \
  --target-branch env/dev # For example
```

## Advanced CLI usage

This section covers additional `bookkeeper render` options that are relevant for
certain scenarios.

* Use `--commit` followed by a commit ID (sha) if you wish to specify a commit
  in your GitOps repository for Bookkeeper to render from (instead of defaulting
  to the commit at the head of the default branch).
  
* Use `--image` to specify a new version of a Docker image to replace an older
  version of the same image. As a convenience, Bookkeeper can accomplish this
  itself in the "last mile" of configuration rendering, regardless of which
  configuration management tool you use and regardless of whether that tool
  supports similar functionality. This option can be specified multiple times if
  your configuration references multiple images.

* Use `--pr` to specify that Bookkeeper should open a pull request against the
  target branch instead of committing directly to it.

  :::note
  At present, this feature only works for GitHub repositories. It does not work
  with other common Git providers, nor does it work with GitHub enterprise.

  Support for Azure DevOps, Bitbucket, GitLab, and GitHub Enterprise is planned.
  :::

  :::note
  PRs cannot be opened against non-existent branches. If the target branch does
  not exist in the remote GitOps repository, Bookkeeper will create the target
  branch and commit directly to it instead.
  :::
